<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Language" content="en" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="description" content="Time Caps is an iOS app through your lifetime, with which you could write to the future you and receive the words and photos you have kept into the Caps at specific date." />
  <meta name="keywords" content="time, caps, cap, capsule, future, today, day, daily, diary, dear, me, life, journal, letter, write" />
  <meta name="author" content="Polaris Chen">
  <title>Time Caps - Reset Password</title>
  <link rel="shortcut icon" href="img/favicon.ico" />
  <link rel="stylesheet" href="css/index.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>

<section>
  <div class="brand">
    <a class="home" href="index.html"><img class="logo" src="img/logo.png" srcSet="img/logo@2x.png 2x" alt="Time Caps" /></a>
  </div>

  <form class="form login-form" name="resetform" >
    <h2>Reset Password</h2>
    <div class="alert" style="display:none" id="error">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>

    <div class="form-group">
      <label class="control-label" for="inputEmail" >New Password</label>
      <input type="password" id="inputEmail" class="form-control" placeholder="New Password" name="password" required>
    </div>

    <div class="form-group">
      <label class="control-label" for="inputPassword" >Confirm Password</label>
      <input type="password" id="inputPassword" class="form-control" placeholder="Confirm Password"  name="password1" required>
    </div>

    <div class="form-group">
      <a class="button" id="reset">Reset</a>
    </div>
  </form>

  <div class="contact">
    <p>For technical assistance or any suggestions, please email me at: <a href="mailto:hi.pol.chen@gmail.com">hi.pol.chen@gmail.com</a> :)</p>
    <p>Crafted with &lt;3 by <a href="http://bus1996.me">Polaris Chen</a></p>
    <div class="social">
      <a href="mailto:hi.pol.chen@gmail.com" class="icon-email"></a>
      <a href="https://twitter.com/PolarisChenCCH" class="icon-twitter"></a>
      <a href="https://instagram.com/pol.chen" class="icon-instagram"></a>
      <a href="http://weibo.com/polchen" class="icon-weibo"></a>
      <a href="https://github.com/PolarisChen" class="icon-github"></a>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/jquery@1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/jaubourg/jquery-jsonp@2.4.0/src/jquery.jsonp.min.js"></script>

<script type="text/javascript">
  var token = location.search.match(/token=(\w*)/);
  if(token&&token[1]){
    token = token[1];
  }
  $(function(){
    $("#reset").click(function(){
      var p = $("[name=password]");
      var p1 = $("[name=password1]");
      if(p.val()!=p1.val()){
        $("#error").show();
        $("#error").text("Passwords do not match. / 两次密码不一致。 >_<");
      }
      if(p.val()&&p1.val()&&p.val()==p1.val()){
        $.jsonp({
          url:"https://tc.bus1996.com/1.1/resetPassword/"+token,
          data:{"password":p.val()},
          callbackParameter: "callback",
          cache: false,
          success:function(result){
            $("#error").show();
            if(result.error){
              $("#error").text("Link expired, please get a new link from the app. / 链接已过期，请重新在 app 中点击「忘记密码」获取新链接。 >_<");
            }else{
              $("#error").text("Reset password succeeded! / 重设密码成功！ ^_^");
            }
          },
          error:function(result,text){
            $("#error").text("Server error, please try again later. / 服务器错误，请稍后再试。 >_<");
          }
        });
      }

    });
  });
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ef5a8b44ee0e4ae6437505a1f36f1eac";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-70440884-7', 'auto');
ga('send', 'pageview');
</script>

</body>

</html>
